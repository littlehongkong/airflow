# ===================================================
# ðŸ§© Warehouse Soda Checks â€” Asset Master
# ===================================================

checks for asset_master:

  # âœ… ê¸°ë³¸ ë°ì´í„° ì¡´ìž¬ ë° í•„ìˆ˜ ì»¬ëŸ¼ ê²€ì¦
  - row_count > 0
  - missing_percent(security_id) = 0
  - missing_percent(ticker) = 0
  - missing_percent(exchange_code) = 0
  - missing_percent(country_code) = 0
  - missing_percent(currency_code) = 0

  # âœ… ê³ ìœ ì„± ë° í‚¤ ë¬´ê²°ì„± ê²€ì¦
  - duplicate_count(security_id) = 0
  - duplicate_count(ticker) = 0

  # âœ… Ticker í˜•ì‹ ê²€ì¦ (ëŒ€ë¬¸ìž/ìˆ«ìž/.-_ ì¡°í•©, 1~20ìž)
  - failed rows:
      name: invalid_ticker_format
      samples limit: 5
      fail condition: |
        ticker IS NULL
        OR ticker = ''
        OR NOT REGEXP_MATCHES(ticker, '^[A-Z0-9._-]{1,20}$')

  # âœ… Exchange Code í˜•ì‹ ê²€ì¦ (ëŒ€ë¬¸ìž/ìˆ«ìž ì¡°í•©, 1~10ìž)
  - failed rows:
      name: invalid_exchange_code_format
      samples limit: 5
      fail condition: |
        exchange_code IS NULL
        OR exchange_code = ''
        OR NOT REGEXP_MATCHES(exchange_code, '^[A-Z0-9]{1,10}$')

  # âœ… êµ­ê°€ì½”ë“œ (ISO2) í˜•ì‹ ê²€ì¦
  - failed rows:
      name: invalid_country_code_format
      samples limit: 5
      fail condition: |
        country_code IS NULL
        OR NOT REGEXP_MATCHES(country_code, '^[A-Z]{2}$')

  # âœ… í†µí™” ì½”ë“œ (ISO4217, 3ìžë¦¬ ëŒ€ë¬¸ìž)
  - failed rows:
      name: invalid_currency_code_format
      samples limit: 5
      fail condition: |
        currency_code IS NOT NULL
        AND LOWER(TRIM(currency_code)) NOT IN ('unknown', 'null', '')
        AND NOT REGEXP_MATCHES(currency_code, '^[A-Z]{3}$')

  # âœ… ISIN í˜•ì‹ ê²€ì¦ (2+9+1ìžë¦¬)
  - failed rows:
      name: invalid_isin_format
      samples limit: 5
      fail condition: |
        isin IS NOT NULL
        AND isin != ''
        AND NOT REGEXP_MATCHES(isin, '^[A-Z]{2}[A-Z0-9]{9}[0-9]$')

  # âœ… CUSIP í˜•ì‹ ê²€ì¦ (9ìžë¦¬ ì˜ë¬¸/ìˆ«ìž)
  - failed rows:
      name: invalid_cusip_format
      samples limit: 5
      fail condition: |
        cusip IS NOT NULL
        AND cusip != ''
        AND NOT REGEXP_MATCHES(cusip, '^[A-Z0-9]{9}$')

  # âœ… LEI í˜•ì‹ ê²€ì¦ (20ìžë¦¬ ì˜ë¬¸/ìˆ«ìž)
  - failed rows:
      name: invalid_lei_format
      samples limit: 5
      fail condition: |
        lei IS NOT NULL
        AND lei != ''
        AND NOT REGEXP_MATCHES(lei, '^[A-Z0-9]{20}$')

  # âœ… ìƒìž¥ì¼ (IPO_DATE) ìœ íš¨ì„± ê²€ì¦ (ì˜¤ëŠ˜ë³´ë‹¤ ë¯¸ëž˜ì¼ìžë©´ ì‹¤íŒ¨)
  - failed rows:
      name: invalid_ipo_date
      samples limit: 5
      fail condition: |
        ipo_date IS NOT NULL
        AND ipo_date > CURRENT_DATE

  # âœ… ìƒí ì—¬ë¶€ í•„ë“œ ë…¼ë¦¬ê°’ ê²€ì¦
  - failed rows:
      name: invalid_is_delisted_value
      samples limit: 5
      fail condition: |
        is_delisted IS NOT NULL
        AND LOWER(TRIM(CAST(is_delisted AS VARCHAR))) NOT IN ('true', 'false', '0', '1')

  # âœ… Vendor / Snapshot ê¸°ì¤€ ê²€ì¦
  - missing_percent(source_vendor) = 0
  - missing_percent(snapshot_date) = 0

  # âœ… ìµœì†Œ ë°ì´í„° ê°œìˆ˜ (êµ­ê°€ ë‹¨ìœ„ ê¸°ì¤€ 100ê°œ ì´ìƒ)
  - row_count >= 100

  # âœ… íŽ€ë”ë©˜í„¸ ë° ì‹¬ë³¼ ìµœì‹  ê¸°ì¤€ì¼ í•„ë“œ ê²€ì¦
  - failed rows:
      name: invalid_last_update_fields
      samples limit: 5
      fail condition: |
        last_symbol_update IS NULL
        OR last_fundamental_update IS NULL

  # âœ… ë¹Œë“œ ê¸°ì¤€ì¼ (snapshot_date) ìœ íš¨ì„±
  - failed rows:
      name: invalid_snapshot_date
      samples limit: 5
      fail condition: |
        snapshot_date IS NULL
        OR snapshot_date > CURRENT_DATE

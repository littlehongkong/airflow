# ===================================================
# üß© Warehouse Soda Checks ‚Äî Holiday Master
# ===================================================

checks for holiday_master:

  # ---------------------------------------------------
  # Í∏∞Î≥∏ row Ï°¥Ïû¨ Í≤ÄÏ¶ù (Íµ≠Í∞ÄÎ≥ÑÎ°ú 0Í∞ú Í∞ÄÎä•)
  # ---------------------------------------------------
  - row_count >= 0

  # ---------------------------------------------------
  # ÌïÑÏàò Ïª¨Îüº NULL ÎπÑÏú® Í≤ÄÏ¶ù
  # ---------------------------------------------------
  - missing_percent(exchange_code) = 0
  - missing_percent(country_code) = 0
  - missing_percent(holiday_date) = 0
  - missing_percent(snapshot_date) = 0
  - missing_percent(source_vendor) = 0
  - missing_percent(created_at) = 0

  # ---------------------------------------------------
  # Exchange Code ÌòïÏãù
  # ---------------------------------------------------
  - failed rows:
      name: invalid_exchange_code_format
      fail condition: |
        exchange_code IS NULL
        OR exchange_code = ''
        OR NOT REGEXP_MATCHES(exchange_code, '^[A-Z0-9._-]{1,10}$')
      samples limit: 5

  # ---------------------------------------------------
  # Country Code ÌòïÏãù
  # ---------------------------------------------------
  - failed rows:
      name: invalid_country_code_format
      fail condition: |
        country_code IS NULL
        OR country_code = ''
        OR NOT REGEXP_MATCHES(country_code, '^[A-Z]{2,3}$')
      samples limit: 5

  # ---------------------------------------------------
  # Holiday Date ÌòïÏãù
  # ---------------------------------------------------
  - failed rows:
      name: invalid_holiday_date_format
      fail condition: |
        holiday_date IS NULL
        OR NOT REGEXP_MATCHES(CAST(holiday_date AS VARCHAR), '^[0-9]{4}-[0-9]{2}-[0-9]{2}')
      samples limit: 5

  # ---------------------------------------------------
  # Holiday Name ‚Üí holiday_date required
  # ---------------------------------------------------
  - failed rows:
      name: holiday_name_without_date
      fail condition: |
        holiday_name IS NOT NULL
        AND holiday_name != ''
        AND holiday_date IS NULL
      samples limit: 5

  # ---------------------------------------------------
  # holiday_type ÌòïÏãù
  # ---------------------------------------------------
  - failed rows:
      name: invalid_holiday_type_format
      fail condition: |
        holiday_type IS NOT NULL
        AND holiday_type != ''
        AND NOT REGEXP_MATCHES(holiday_type, '^[A-Za-z0-9 _-]+$')
      samples limit: 5

  # ---------------------------------------------------
  # snapshot_date Í≤ÄÏ¶ù
  # ---------------------------------------------------
  - failed rows:
      name: invalid_snapshot_date_format
      fail condition: |
        snapshot_date IS NULL
        OR NOT REGEXP_MATCHES(CAST(snapshot_date AS VARCHAR), '^[0-9]{4}-[0-9]{2}-[0-9]{2}')
      samples limit: 5

  # ---------------------------------------------------
  # source_vendor Îπà Í∞í Í∏àÏßÄ
  # ---------------------------------------------------
  - failed rows:
      name: invalid_source_vendor
      fail condition: |
        source_vendor IS NULL
        OR source_vendor = ''
      samples limit: 5

  # ---------------------------------------------------
  # created_at NULL Í∏àÏßÄ
  # ---------------------------------------------------
  - failed rows:
      name: invalid_created_at
      fail condition: |
        created_at IS NULL
      samples limit: 5

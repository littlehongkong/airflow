# ===================================================
# ðŸ§© Warehouse Soda Checks â€” Exchange Master
# ===================================================

checks for exchange_master:

  # âœ… ê¸°ë³¸ ë°ì´í„° ì¡´ìž¬ ë° í•„ìˆ˜ ì»¬ëŸ¼ ê²€ì¦
  - row_count > 0
  - missing_percent(exchange_code) = 0
  - missing_percent(country_code) = 0
  - missing_percent(country_iso2) = 0
  - missing_percent(currency_code) = 0

  # âœ… Exchange Code ì¤‘ë³µ ê²€ì¦
  - duplicate_count(exchange_code) = 0

  # âœ… Exchange Code í˜•ì‹ ê²€ì¦ (ëŒ€ë¬¸ìž/ìˆ«ìž ì¡°í•©, 1~10ìž)
  - failed rows:
      name: invalid_exchange_code_format
      samples limit: 5
      fail condition: |
        exchange_code IS NULL
        OR exchange_code = ''
        OR NOT REGEXP_MATCHES(exchange_code, '^[A-Z0-9]{1,10}$')

  # âœ… Country Name í•„ë“œ ê²€ì¦ (ë¹ˆ ë¬¸ìžì—´/NULL ê¸ˆì§€)
  - failed rows:
      name: invalid_country_code_empty_or_whitespace
      samples limit: 5
      fail condition: |
        country_code IS NULL OR country_code = '' OR TRIM(country_code) = ''

  # âœ… ISO2 ì½”ë“œ ê²€ì¦ (2ìžë¦¬ ëŒ€ë¬¸ìž)
  - failed rows:
      name: invalid_country_iso2
      samples limit: 5
      fail condition: |
        country_iso2 IS NOT NULL
        AND country_iso2 != ''
        AND LOWER(country_iso2) != 'unknown'
        AND NOT REGEXP_MATCHES(country_iso2, '^[A-Z]{2}$')

  # âœ… Currency ì½”ë“œ ê²€ì¦ (3ìžë¦¬ ëŒ€ë¬¸ìž)
  - failed rows:
      name: invalid_currency_code_format
      samples limit: 5
      fail condition: |
        currency_code IS NOT NULL
        AND LOWER(TRIM(currency_code)) NOT IN ('unknown', 'null', '')
        AND NOT REGEXP_MATCHES(TRIM(currency_code), '^[A-Z]{2,6}$')


  # âœ… OperatingMIC í˜•ì‹ ê²€ì¦ (null, ê³µë°±, ì‰¼í‘œ í¬í•¨ ê°€ëŠ¥)
  - failed rows:
      name: invalid_operating_mic_format
      samples limit: 5
      fail condition: |
        operating_mic IS NOT NULL
        AND operating_mic != ''
        AND NOT REGEXP_MATCHES(operating_mic, '^[A-Z, ]+$')

  # âœ… Timezone í˜•ì‹ ê²€ì¦ (ì˜ˆ: UTC+09, UTC-05)
  - failed rows:
      name: invalid_timezone_format
      samples limit: 5
      fail condition: |
        timezone IS NULL
        OR timezone = ''

  # âœ… ìµœì†Œ ê±°ëž˜ì†Œ ìˆ˜ ê²€ì¦ (ì˜ˆ: 10ê°œ ì´ìƒ)
  - row_count >= 2
